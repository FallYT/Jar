<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Growtopia Donation Jar Overlay</title>
<style>
  body {
    background: transparent;
    font-family: 'Arial', sans-serif;
    color: white;
    margin: 0;
    overflow: hidden;
    user-select: none;
  }
  #container {
    position: relative;
    width: 400px;
    margin: 20px auto;
    text-align: center;
  }
  #jar {
    position: relative;
    margin: 0 auto;
    width: 300px;
    height: 400px;
    background: url('jar.png') no-repeat center bottom;
    background-size: contain;
    overflow: hidden;
    border-radius: 40px 40px 80px 80px;
    box-shadow: inset 0 0 30px rgba(255,255,255,0.15);
  }
  #fall-area {
    position: absolute;
    bottom: 0;
    left: 10%;
    width: 80%;
    height: 380px;
    pointer-events: none;
    overflow: visible;
  }
  .falling-lock {
    position: absolute;
    bottom: 0;
    width: 30px;
    height: 30px;
    background-size: contain;
    background-repeat: no-repeat;
    animation-name: fall;
    animation-duration: 3s;
    animation-timing-function: linear;
    animation-fill-mode: forwards;
  }
  .world-lock {
    background-image: url('worldlock.png');
  }
  .diamond-lock {
    background-image: url('diamondlock.png');
  }
  @keyframes fall {
    0% {
      transform: translateY(0);
      opacity: 1;
    }
    90% {
      opacity: 1;
    }
    100% {
      transform: translateY(350px);
      opacity: 0;
    }
  }
  #progress-container {
    width: 300px;
    height: 20px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 10px;
    margin: 15px auto 0;
    overflow: hidden;
  }
  #progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #00f0ff, #0055ff);
    width: 0%;
    transition: width 0.5s ease;
  }
  #progress-text {
    margin-top: 5px;
    font-size: 16px;
  }
  #control-panel {
    width: 400px;
    margin: 10px auto;
    color: white;
    text-align: center;
  }
  input[type="number"] {
    width: 60px;
    padding: 5px;
    margin: 0 5px;
    font-size: 16px;
    border-radius: 6px;
    border: none;
    text-align: center;
  }
  button {
    padding: 8px 20px;
    font-size: 16px;
    margin-left: 10px;
    cursor: pointer;
    border-radius: 6px;
    border: none;
    background-color: #0077ff;
    color: white;
  }
</style>
</head>
<body>
  <div id="container">
    <div id="jar">
      <div id="fall-area"></div>
    </div>
    <div id="progress-container">
      <div id="progress-fill"></div>
    </div>
    <div id="progress-text">Goal: 500 DL — Raised: 0 DL (0%)</div>
  </div>
  <div id="control-panel">
    <label>World Locks:</label>
    <input type="number" id="wlCount" min="0" value="0" />
    <label>Diamond Locks:</label>
    <input type="number" id="dlCount" min="0" value="0" />
    <button id="dropBtn">Drop</button>
  </div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
  import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDos-kzkfRV1n6_quPwFvdNthftUp7OosE",
    authDomain: "donation-jar.firebaseapp.com",
    databaseURL: "https://donation-jar-default-rtdb.firebaseio.com",
    projectId: "donation-jar",
    storageBucket: "donation-jar.firebasestorage.app",
    messagingSenderId: "522917607890",
    appId: "1:522917607890:web:1a9ff308086ef0852b300b",
    measurementId: "G-W1RHFNSYZN"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const totalRaisedRef = ref(db, 'totalRaised');

  const GOAL = 500;

  const fallArea = document.getElementById('fall-area');
  const progressText = document.getElementById('progress-text');
  const progressFill = document.getElementById('progress-fill');
  const dropBtn = document.getElementById('dropBtn');
  const wlInput = document.getElementById('wlCount');
  const dlInput = document.getElementById('dlCount');

  let totalRaised = 0;

  function createLock(type) {
    const lock = document.createElement('div');
    lock.classList.add('falling-lock', type === 'DL' ? 'diamond-lock' : 'world-lock');
    lock.style.left = `${Math.random() * 85 + 5}%`;
    fallArea.appendChild(lock);
    lock.addEventListener('animationend', () => lock.remove());
  }

  function dropLocks(type, count) {
    for (let i = 0; i < count; i++) {
      setTimeout(() => createLock(type), i * 150);
    }
  }

  function updateProgressBar() {
    const percent = Math.min((totalRaised / GOAL) * 100, 100).toFixed(1);
    progressText.textContent = `Goal: ${GOAL} DL — Raised: ${totalRaised.toFixed(2)} DL (${percent}%)`;
    progressFill.style.width = `${percent}%`;
  }

  dropBtn.onclick = async () => {
    const wl = parseInt(wlInput.value) || 0;
    const dl = parseInt(dlInput.value) || 0;
    const dlValue = dl + wl / 100;
    const newTotal = totalRaised + dlValue;

    await set(totalRaisedRef, newTotal);

    dropLocks("WL", wl);
    dropLocks("DL", dl);

    wlInput.value = 0;
    dlInput.value = 0;
  };

  onValue(totalRaisedRef, (snapshot) => {
    totalRaised = snapshot.val() || 0;
    updateProgressBar();
  });
</script>
</body>
</html>
